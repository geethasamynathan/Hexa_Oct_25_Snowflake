# 🧊 Explanation --- Create Share in Snowflake (Step-by-Step with SQL)

## 🔹 Step 1: Create a Database

``` sql
CREATE OR REPLACE DATABASE DATA_S;
```

**Explanation:**\
Creates a new logical database `DATA_S` for storing shared data.\
`OR REPLACE` recreates it if already exists.

------------------------------------------------------------------------

## 🔹 Step 2: Create an External Stage

``` sql
CREATE OR REPLACE STAGE aws_stage
    url='s3://bucketsnowflakes3';
```

**Explanation:**\
Defines a stage that points to an S3 bucket. Snowflake will read data
files (like CSVs) from here.

------------------------------------------------------------------------

## 🔹 Step 3: List Files in Stage

``` sql
LIST @aws_stage;
```

**Explanation:**\
Lists files available in the external S3 stage. Helps confirm
connectivity and available data files.

------------------------------------------------------------------------

## 🔹 Step 4: Create Target Table

``` sql
CREATE OR REPLACE TABLE ORDERS (
ORDER_ID VARCHAR(30),
AMOUNT NUMBER(38,0),
PROFIT NUMBER(38,0),
QUANTITY NUMBER(38,0),
CATEGORY VARCHAR(30),
SUBCATEGORY VARCHAR(30)
);
```

**Explanation:**\
Defines a table structure in Snowflake to store the imported order data.

------------------------------------------------------------------------

## 🔹 Step 5: Load Data Using COPY Command

``` sql
COPY INTO ORDERS
    FROM @MANAGE_DB.external_stages.aws_stage
    file_format= (type = csv field_delimiter=',' skip_header=1)
    pattern='.*OrderDetails.*';
```

**Explanation:**\
Loads data from the S3 stage into the ORDERS table using Snowflake's
COPY INTO command.\
- Reads only CSVs that match the regex pattern "OrderDetails"\
- Skips header row and parses comma-separated fields

------------------------------------------------------------------------

## 🔹 Step 6: Verify Data

``` sql
SELECT * FROM ORDERS;
```

**Explanation:**\
Displays the loaded data for validation before sharing.

------------------------------------------------------------------------

## 🔹 Step 7: Create a Share Object

``` sql
CREATE OR REPLACE SHARE ORDERS_SHARE;
```

**Explanation:**\
Creates a share container named `ORDERS_SHARE` to hold objects and
permissions you plan to share.

------------------------------------------------------------------------

## 🔹 Step 8: Grant Privileges to the Share

``` sql
GRANT USAGE ON DATABASE DATA_S TO SHARE ORDERS_SHARE;
GRANT USAGE ON SCHEMA DATA_S.PUBLIC TO SHARE ORDERS_SHARE;
GRANT SELECT ON TABLE DATA_S.PUBLIC.ORDERS TO SHARE ORDERS_SHARE;
```

**Explanation:**\
Grants read-only access to the consumer:\
- `USAGE` on database/schema lets them access structure\
- `SELECT` on table lets them query data

  Object Type   Privilege   Purpose
  ------------- ----------- ---------------------
  Database      USAGE       Allow visibility
  Schema        USAGE       Allow schema access
  Table         SELECT      Allow querying data

------------------------------------------------------------------------

## 🔹 Step 9: Validate Grants

``` sql
SHOW GRANTS TO SHARE ORDERS_SHARE;
```

**Explanation:**\
Displays the privileges granted to the share for auditing or validation.

------------------------------------------------------------------------

## 🔹 Step 10: Add Consumer Account

``` sql
ALTER SHARE ORDERS_SHARE ADD ACCOUNT=<consumer-account-id>;
```

**Explanation:**\
Links your share to the consumer's Snowflake account (identified by
account locator).\
Once added, the consumer can create a database from this share.

**Example:**

``` sql
ALTER SHARE ORDERS_SHARE ADD ACCOUNT='xy12345';
```

------------------------------------------------------------------------

## 🔹 Consumer Side Commands

``` sql
CREATE DATABASE DATA_S_SHARED FROM SHARE <provider_account_locator>.ORDERS_SHARE;
SELECT * FROM DATA_S_SHARED.PUBLIC.ORDERS;
```

**Explanation:**\
The consumer can query your shared ORDERS table directly without data
duplication.

------------------------------------------------------------------------

## 📊 Architecture Diagram

    ┌──────────────────────────────┐
    │ Provider Account (Your Org)  │
    │ DATABASE: DATA_S             │
    │ TABLE: ORDERS                │
    │ SHARE: ORDERS_SHARE          │
    │  ├── GRANT SELECT            │
    │  ├── ADD CONSUMER ACCOUNT    │
    │  ▼                           │
    └──────────────┬───────────────┘
                   │ Secure Data Share
                   ▼
    ┌──────────────────────────────┐
    │ Consumer Account (Partner)   │
    │ CREATE DATABASE FROM SHARE   │
    │ SELECT * FROM SHARED.ORDERS  │
    └──────────────────────────────┘

------------------------------------------------------------------------

## ✅ Final Outcome

  -----------------------------------------------------------------------
  Role               Action                      Result
  ------------------ --------------------------- ------------------------
  **Provider**       Creates share & grants      Shares data securely
                     SELECT                      

  **Consumer**       Creates database from share Reads live data
                                                 instantly

  **Both**           No data copy involved       Saves storage & sync
                                                 time
  -----------------------------------------------------------------------

------------------------------------------------------------------------

**Conclusion:**\
This SQL workflow demonstrates secure, zero-copy data sharing in
Snowflake using external data (S3), table creation, and share management
with privileges and consumer linking.
